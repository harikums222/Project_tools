---
// SWPCalculator Component
import AdSidebar from '../Ads/AdSidebar.astro';
---

<section class="py-12 bg-gradient-to-br from-orange-50 via-white to-red-50">
	<div class="container mx-auto px-4">
		<div class="grid grid-cols-1 md:grid-cols-[240px_1fr] gap-12">
			<!-- Side Ads -->
			<div class="hidden md:block">
				<AdSidebar />
			</div>

			<!-- Core Content -->
			<div>
				<div class="text-center max-w-2xl mx-auto mb-12">
					<h1 class="text-4xl font-extrabold text-gray-900 mb-4 tracking-tight">SWP <span class="text-orange-600">Calculator</span></h1>
					<p class="text-lg text-gray-600">Systematic Withdrawal Plan (SWP) Calculator to plan your monthly income.</p>
				</div>

				<div class="max-w-4xl mx-auto bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden p-8 mb-8">
					<div class="grid grid-cols-1 md:grid-cols-2 gap-8">
						<div class="space-y-6">
							<div>
								<label class="block text-sm font-semibold text-gray-700 mb-2">Initial Corpus (₹)</label>
								<input type="number" id="swp-corpus" value="1000000" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-orange-500 transition-all outline-none" />
								<input type="range" id="swp-corpus-range" min="100000" max="10000000" step="50000" value="1000000" class="w-full mt-4 accent-orange-600 cursor-pointer" />
							</div>
							<div>
								<label class="block text-sm font-semibold text-gray-700 mb-2">Monthly Withdrawal (₹)</label>
								<input type="number" id="swp-withdrawal" value="10000" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-orange-500 transition-all outline-none" />
								<input type="range" id="swp-withdrawal-range" min="1000" max="100000" step="1000" value="10000" class="w-full mt-4 accent-orange-600 cursor-pointer" />
							</div>
							<div>
								<label class="block text-sm font-semibold text-gray-700 mb-2">Expected Return (%)</label>
								<input type="number" id="swp-rate" value="8" step="0.1" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-orange-500 transition-all outline-none" />
								<input type="range" id="swp-rate-range" min="1" max="20" step="0.1" value="8" class="w-full mt-4 accent-orange-600 cursor-pointer" />
							</div>
							<div>
								<label class="block text-sm font-semibold text-gray-700 mb-2">Tenure (Years)</label>
								<input type="number" id="swp-years" value="10" class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-orange-500 transition-all outline-none" />
								<input type="range" id="swp-years-range" min="1" max="40" step="1" value="10" class="w-full mt-4 accent-orange-600 cursor-pointer" />
							</div>
						</div>

						<div class="bg-orange-50 rounded-2xl p-8 flex flex-col justify-center space-y-6 border border-orange-100">
							<div class="text-center">
								<p class="text-orange-600 font-semibold mb-1">Final Balance</p>
								<h2 class="text-4xl font-bold text-gray-900" id="swp-final">₹ 1,00,000</h2>
							</div>
							<div class="grid grid-cols-2 gap-4 pt-6 border-t border-orange-200">
								<div class="text-center">
									<p class="text-gray-500 text-xs font-bold uppercase tracking-wider mb-1">Total Withdrawn</p>
									<p class="text-lg font-bold text-gray-800" id="swp-total">₹ 12,00,000</p>
								</div>
								<div class="text-center">
									<p class="text-gray-500 text-xs font-bold uppercase tracking-wider mb-1">Gain/Loss</p>
									<p class="text-lg font-bold text-orange-600" id="swp-gains">₹ 3,00,000</p>
								</div>
							</div>
                            <div class="pt-6 border-t border-orange-200">
                                <canvas id="swpChart" height="150"></canvas>
                            </div>
						</div>
					</div>
				</div>

				<article class="prose prose-orange max-w-none">
					<h2 class="text-3xl font-bold text-gray-900 mb-6 font-display">What is a Systematic Withdrawal Plan (SWP)?</h2>
					<p class="text-gray-600 leading-relaxed mb-6">
						A Systematic Withdrawal Plan (SWP) allows an investor to withdraw a fixed amount of money from their investment (like a mutual fund) at regular intervals. It is essentially the opposite of a SIP. While SIP is used for wealth creation, SWP is often used for wealth distribution, especially during retirement.
					</p>
					
					<h2 class="text-3xl font-bold text-gray-900 mt-12 mb-6">How SWP Works</h2>
					<p class="text-gray-600 leading-relaxed mb-6">
						1. You invest a lumpsum amount in a scheme.<br/>
						2. You choose a monthly withdrawal amount.<br/>
						3. The remaining amount in the scheme continues to grow at the expected return rate.<br/>
						4. Every month, the withdrawal is deducted from the balance.
					</p>

					<h2 class="text-3xl font-bold text-gray-900 mt-12 mb-6">Taxability of SWP</h2>
					<p class="text-gray-600 leading-relaxed mb-6">
						In India, SWP withdrawals from mutual funds are treated as redemptions. If it's an equity fund, LTCG tax (12.5%) applies to gains exceeding ₹1.25 Lakh per year for units held over 12 months. For units held less than 12 months, STCG tax (20%) applies.
					</p>
				</article>
			</div>
		</div>
	</div>
</section>

<script is:inline>
	const formatINR = (amount) => {
		return '₹ ' + Math.round(amount).toLocaleString('en-IN');
	};

	const calculateSWP = () => {
		const corpus = parseFloat(document.getElementById('swp-corpus').value) || 0;
		const withdrawal = parseFloat(document.getElementById('swp-withdrawal').value) || 0;
		const annualRate = parseFloat(document.getElementById('swp-rate').value) || 0;
		const years = parseFloat(document.getElementById('swp-years').value) || 0;

		if (corpus <= 0 || withdrawal <= 0 || annualRate <= 0 || years <= 0) return;

		let balance = corpus;
		const monthlyRate = annualRate / 12 / 100;
		const months = years * 12;
		let totalWithdrawn = 0;

		for (let m = 1; m <= months; m++) {
			totalWithdrawn += withdrawal;
			balance = (balance - withdrawal) * (1 + monthlyRate);
			if (balance < 0) {
				balance = 0;
				break;
			}
		}

		const gains = balance + totalWithdrawn - corpus;

		document.getElementById('swp-final').innerText = formatINR(balance);
		document.getElementById('swp-total').innerText = formatINR(totalWithdrawn);
		document.getElementById('swp-gains').innerText = formatINR(gains);

        // Chart Data
        const labels = [];
        const balanceData = [];
        const withdrawnData = [];
        
        let tempBalance = corpus;
        let tempWithdrawn = 0;
        labels.push('Yr 0');
        balanceData.push(corpus);
        withdrawnData.push(0);

        for (let y = 1; y <= years; y++) {
            for (let m = 1; m <= 12; m++) {
                tempWithdrawn += withdrawal;
                tempBalance = (tempBalance - withdrawal) * (1 + monthlyRate);
                if (tempBalance < 0) tempBalance = 0;
            }
            labels.push('Yr ' + y);
            balanceData.push(tempBalance);
            withdrawnData.push(tempWithdrawn);
            if (tempBalance <= 0) break;
        }
        updateChart(labels, withdrawnData, balanceData);
	};

    let swpChart;
    const updateChart = (labels, withdrawn, balance) => {
        const ctx = document.getElementById('swpChart').getContext('2d');
        if (swpChart) swpChart.destroy();
        swpChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    { label: 'Total Withdrawn', data: withdrawn, borderColor: '#94a3b8', borderWidth: 2, pointRadius: 0, tension: 0.1, fill: false },
                    { label: 'Remaining Balance', data: balance, borderColor: '#ea580c', borderWidth: 3, pointRadius: 0, tension: 0.1, fill: false }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { position: 'bottom', labels: { boxWidth: 12, font: { size: 10, weight: 'bold' } } },
                    tooltip: { mode: 'index', intersect: false, callbacks: { label: (ctx) => ctx.dataset.label + ': ' + formatINR(ctx.raw) } }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: (val) => {
                                if (val >= 10000000) return '₹' + (val/10000000).toFixed(1) + 'Cr';
                                if (val >= 100000) return '₹' + (val/100000).toFixed(1) + 'L';
                                return '₹' + val.toLocaleString('en-IN');
                            },
                            font: { size: 10 }
                        }
                    },
                    x: { ticks: { font: { size: 10 } } }
                }
            }
        });
    };

	const syncSWP = (inputId, rangeId) => {
		const input = document.getElementById(inputId);
		const range = document.getElementById(rangeId);
		if (input && range) {
			input.addEventListener('input', () => {
				range.value = input.value;
				calculateSWP();
			});
			range.addEventListener('input', () => {
				input.value = range.value;
				calculateSWP();
			});
		}
	};

	syncSWP('swp-corpus', 'swp-corpus-range');
	syncSWP('swp-withdrawal', 'swp-withdrawal-range');
	syncSWP('swp-rate', 'swp-rate-range');
	syncSWP('swp-years', 'swp-years-range');

	calculateSWP();
</script>

<style>
	input[type="range"] {
		-webkit-appearance: none;
		height: 6px;
		background: #e2e8f0;
		border-radius: 5px;
		background-image: linear-gradient(#ea580c, #ea580c);
		background-repeat: no-repeat;
	}
	
	input::-webkit-outer-spin-button,
	input::-webkit-inner-spin-button {
	-webkit-appearance: none;
	margin: 0;
	}

	input[type=number] {
	-moz-appearance: textfield;
	}
</style>
